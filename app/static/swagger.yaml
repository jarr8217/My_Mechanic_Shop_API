swagger: "2.0"
info:
  title: "My Mechanic Shop API"
  description: "API for managing customers, orders, and services at mechanic shop"
  version: "1.0.0"
host: "127.0.0.1:5000"
schemes:
  - "http"
consumes:
  - "application/json"
produces:
  - "application/json"

# --- SECURITY DEFINITIONS ---
securityDefinitions:
  bearerAuth:
    type: "apiKey"
    name: "Authorization"
    in: "header"

# ==========================
#         PATHS
# ==========================
paths:
  # --- AUTH ---
  /auth/login:
    post:
      tags: ["Authentication"]
      summary: "Login endpoint (Generates JWT Token)"
      description: "Allows customers to log into their accounts"
      parameters:
        - in: body
          name: body
          description: "Login credentials for the customer"
          required: true
          schema:
            $ref: "#/definitions/LoginCredentials"
      responses:
        '200':
          description: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
        '400':
          description: "Invalid credentials"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '500':
          description: "Internal server error"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /auth/mechanic_login:
    post:
      tags: ["Authentication"]
      summary: "Mechanic login endpoint (Generates JWT Token)"
      description: "Allows mechanics to log into their accounts"
      parameters:
        - in: body
          name: body
          description: "Login credentials for the mechanic"
          required: true
          schema:
            $ref: "#/definitions/LoginCredentials"
      responses:
        '200':
          description: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
        '400':
          description: "Invalid credentials"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '500':
          description: "Internal server error"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # --- CUSTOMERS MAIN ---
  /customers:
    post:
      tags: ["Customers"]
      summary: "Register a new customer"
      description: "Register a new customer. Requires name, email, phone, and password."
      parameters:
        - in: body
          name: body
          description: "Customer registration data"
          required: true
          schema:
            $ref: "#/definitions/Customer"
      responses:
        '201':
          description: "Customer created successfully"
          schema:
            $ref: "#/definitions/CustomerResponse"
        '400':
          description: "Invalid input or email already exists"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '500':
          description: "Internal server error"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags: ["Customers"]
      summary: "Get all customers"
      description: "Retrieve a paginated list of all customers (mechanic only)."
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: "Page number (default 1)"
          required: false
          type: integer
        - name: limit
          in: query
          description: "Number of results per page (default 20)"
          required: false
          type: integer
      responses:
        '200':
          description: "List of customers"
          schema:
            $ref: "#/definitions/PaginatedCustomersResponse"
        '400':
          description: "Invalid request"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Forbidden"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '500':
          description: "Internal server error"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # --- CUSTOMERS BY ID ---
  /customers/{customer_id}:
    get:
      tags: ["Customers"]
      summary: "Get a customer by ID"
      description: "Mechanic or the customer themselves can get customer info."
      security:
        - bearerAuth: []
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
          description: "Customer ID"
      responses:
        '200':
          description: "Customer found"
          schema:
            $ref: "#/definitions/CustomerResponse"
        '403':
          description: "Forbidden"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags: ["Customers"]
      summary: "Update a customer"
      description: "Customer can update their own data."
      security:
        - bearerAuth: []
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
          description: "Customer ID"
        - in: body
          name: body
          description: "Updated customer data"
          required: true
          schema:
            $ref: "#/definitions/Customer"
      responses:
        '200':
          description: "Customer updated"
          schema:
            $ref: "#/definitions/CustomerResponse"
        '400':
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    patch:
      tags: ["Customers"]
      summary: "Partially update a customer"
      description: "Customer can partially update their own data."
      security:
        - bearerAuth: []
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
          description: "Customer ID"
        - in: body
          name: body
          description: "Partial customer data"
          required: true
          schema:
            $ref: "#/definitions/CustomerPartialUpdate"
      responses:
        '200':
          description: "Customer updated"
          schema:
            $ref: "#/definitions/CustomerResponse"
        '400':
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags: ["Customers"]
      summary: "Delete a customer"
      description: "Customer can delete their own data."
      security:
        - bearerAuth: []
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
          description: "Customer ID"
      responses:
        '200':
          description: "Customer deleted"
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Customer: 101, successfully deleted!"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /customers/search:
    get:
      tags: ["Customers"]
      summary: "Search customers"
      description: "Search for customers by name or email."
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: query
          description: "Customer name (optional)"
          required: false
          type: string
        - name: email
          in: query
          description: "Customer email (optional)"
          required: false
          type: string
      responses:
        '200':
          description: "Customers found"
          schema:
            type: array
            items:
              $ref: "#/definitions/CustomerResponse"
        '400':
          description: "Invalid search criteria"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Forbidden"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "No customers found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # --- MECHANICS MAIN ---
  /mechanics:
    post:
      tags:
        - "Mechanics"
      summary: "Create a new mechanic"
      description: "Register a new mechanic (RBAC: mechanic only)"
      security:
        - bearerAuth: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          description: "Mechanic registration data"
          schema:
            $ref: "#/definitions/Mechanic"
      responses:
        '201':
          description: "Mechanic created successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"
        '400':
          description: "Mechanic already exists or invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '500':
          description: "Internal server error"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags:
        - "Mechanics"
      summary: "Get all mechanics"
      description: "Retrieve paginated mechanics (RBAC: mechanic only)"
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          type: integer
          required: false
          description: "Page number (default 1)"
        - name: per_page
          in: query
          type: integer
          required: false
          description: "Mechanics per page (default 20)"
      responses:
        '200':
          description: "List of mechanics"
          schema:
            $ref: "#/definitions/PaginatedMechanicsResponse"
        '400':
          description: "Invalid query params"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "No mechanics found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /mechanics/{mechanic_id}:
    get:
      tags:
        - "Mechanics"
      summary: "Get a mechanic by ID"
      description: "Mechanic or customer can get mechanic info"
      security:
        - bearerAuth: []
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
          description: "Mechanic ID"
      responses:
        '200':
          description: "Mechanic found"
          schema:
            $ref: "#/definitions/MechanicResponse"
        '403':
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - "Mechanics"
      summary: "Update a mechanic"
      description: "Update a mechanic's information"
      security:
        - bearerAuth: []
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          description: "Mechanic data to update"
          schema:
            $ref: "#/definitions/Mechanic"
      responses:
        '200':
          description: "Mechanic updated"
          schema:
            $ref: "#/definitions/MechanicResponse"
        '400':
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"

    patch:
      tags:
        - "Mechanics"
      summary: "Partially update a mechanic"
      description: "Update select fields for mechanic"
      security:
        - bearerAuth: []
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          description: "Partial mechanic data"
          schema:
            $ref: "#/definitions/MechanicPartialUpdate"
      responses:
        '200':
          description: "Mechanic updated"
          schema:
            $ref: "#/definitions/MechanicResponse"
        '400':
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - "Mechanics"
      summary: "Delete a mechanic"
      description: "Deletes a mechanic by ID"
      security:
        - bearerAuth: []
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        '200':
          description: "Mechanic deleted"
          schema:
            $ref: "#/definitions/MechanicDeleteResponse"
        '404':
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /mechanics/popular:
    get:
      tags:
        - "Mechanics"
      summary: "Get popular mechanics"
      description: "Get mechanics sorted by the number of service tickets"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Popular mechanics list"
          schema:
            type: array
            items:
              $ref: "#/definitions/MechanicResponse"
        '403':
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "No mechanics found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /mechanics/search:
    get:
      tags:
        - "Mechanics"
      summary: "Search mechanics"
      description: "Search mechanics by name or email"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: query
          type: string
          required: false
          description: "Mechanic name (optional)"
        - name: email
          in: query
          type: string
          required: false
          description: "Mechanic email (optional)"
      responses:
        '200':
          description: "Mechanics found"
          schema:
            type: array
            items:
              $ref: "#/definitions/MechanicResponse"
        '400':
          description: "Invalid search criteria"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '403':
          description: "Unauthorized"
          schema:
            $ref: "#/definitions/ErrorResponse"
        '404':
          description: "No mechanics found"
          schema:
            $ref: "#/definitions/ErrorResponse"


# ==========================
#      DEFINITIONS
# ==========================

definitions:
  # --- AUTH Customer ---
  LoginCredentials:
    type: object
    required: [email, password]
    properties:
      email:
        type: string
        format: email
        example: "user@example.com"
      password:
        type: string
        example: "password123"

  LoginResponse:
    type: object
    properties:
      status:
        type: string
        example: "Login successful"
      token:
        type: string
      user:
        type: object
        properties:
          id:
            type: integer
            example: 123
          email:
            type: string
            example: "email@example.com"
          role:
            type: string
            example: "customer"

  # --- CUSTOMERS ---
  Customer:
    type: object
    required: [name, email, phone, password]
    properties:
      name:
        type: string
        example: "John Doe"
      email:
        type: string
        format: email
        example: "john@example.com"
      phone:
        type: string
        example: "555-1234"
      password:
        type: string
        example: "mysecretpassword"

  CustomerResponse:
    type: object
    properties:
      id:
        type: integer
        example: 101
      name:
        type: string
        example: "John Doe"
      email:
        type: string
        example: "john@example.com"
      phone:
        type: string
        example: "555-1234"

  PaginatedCustomersResponse:
    type: object
    properties:
      customers:
        type: array
        items:
          $ref: "#/definitions/CustomerResponse"
      page:
        type: integer
        example: 1
      per_page:
        type: integer
        example: 20
      total:
        type: integer
        example: 123
      pages:
        type: integer
        example: 7

  ErrorResponse:
    type: object
    properties:
      error:
        type: string
        example: "Invalid email or password"

  CustomerPartialUpdate:
    type: object
    properties:
      name:
        type: string
        example: "John Doe"
      email:
        type: string
        format: email
        example: "john@example.com"
      phone:
        type: string
        example: "555-1234"

  CustomerDeleteResponse:
    type: object
    properties:
      message:
        type: string
        example: "Customer: 101, successfully deleted!"

  CustomerSearchResponse:
    type: object
    properties:
      customers:
        type: array
        items:
          $ref: "#/definitions/CustomerResponse"
      total:
        type: integer
        example: 2
      page:
        type: integer
        example: 1
      per_page:
        type: integer
        example: 20
      pages:
        type: integer
        example: 1

  # --- Mechanics AUTH ---
  MechanicLoginCredentials:
    type: object
    required:
      - email
      - password
    properties:
      email:
        type: string
        format: email
        example: "mechanic@example.com"
      password:
        type: string
        example: "password123"

  MechanicLoginResponse:
    type: object
    properties:
      token:
        type: string
        example: "jwt.token.here"
      user:
        type: object
        properties:
          id:
            type: integer
            example: 42
          email:
            type: string
            example: "mechanic@example.com"
          role:
            type: string
            example: "mechanic"

  # --- Mechanics ---
  Mechanic:
    type: object
    required:
      - name
      - email
      - phone
      - salary
      - password
    properties:
      name:
        type: string
        example: "Jane Smith"
      email:
        type: string
        example: "jane.smith@example.com"
      phone:
        type: string
        example: "555-5678"
      salary:
        type: number
        format: float
        example: 60000
      password:
        type: string
        example: "supersecret"

  MechanicResponse:
    type: object
    properties:
      id:
        type: integer
        example: 1001
      name:
        type: string
        example: "Jane Smith"
      email:
        type: string
        example: "jane.smith@example.com"

  PaginatedMechanicsResponse:
    type: object
    properties:
      mechanics:
        type: array
        items:
          $ref: "#/definitions/MechanicResponse"
      total:
        type: integer
        example: 12
      pages:
        type: integer
        example: 2
      current_page:
        type: integer
        example: 1
      has_next:
        type: boolean
        example: true
      has_prev:
        type: boolean
        example: false

  MechanicPartialUpdate:
    type: object
    properties:
      name:
        type: string
      email:
        type: string
      password:
        type: string

  MechanicDeleteResponse:
    type: object
    properties:
      message:
        type: string
        example: "Mechanic: ID: 1001 Name: Jane Smith deleted successfully"

  MechanicErrorResponse:
    type: object
    properties:
      error:
        type: string
        example: "Mechanic not found"
